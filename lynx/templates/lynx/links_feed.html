{% extends 'lynx/base.html' %}

{% block title %}{{ title }} | Lynx{% endblock %}

{% block nav_title %}{{ title }}{% endblock %}

{% block content %}
  <details class="collapse bg-base-200 collapse-arrow border border-base-300" {% if selected_filter != 'all' %}open{% endif %}>
    <summary class="collapse-title text-xl font-medium">
      Search & Filters
    </summary>
    <div class="collapse-content"> 
      <div class="grid grid-cols-2 gap-4">
        <div>
          <div class="join w-full">
            <a href="{% url 'lynx:links_feed_read' %}" class="w-1/3 join-item btn btn-primary {% if selected_filter != 'read'%}btn-outline{% endif %}">Read</a>
            <a href="{% url 'lynx:links_feed_unread' %}" class="w-1/3 join-item btn btn-primary {% if selected_filter != 'unread'%}btn-outline{% endif %}">Unread</a>
            <a href="{% url 'lynx:links_feed_all' %}" class="w-1/3 btn join-item btn-primary {% if selected_filter != 'all'%}btn-outline{% endif %}">All</a>
          </div>
        </div>
        <form role="search" action="{% url 'lynx:links_feed_search' %}" method="get" class="w-full">
          <div class="join w-full">
            <input type="text" name="q" class="join-item input input-bordered w-full" placeholder="Search" value="{{ query }}" autocomplete="off"/>
            <button class="btn btn-primary join-item">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
              </svg>
            </button>
          </div>
        </form>
      </div>
    </div>
  </details>
  {% if paginator_page and paginator_page.object_list %}
  {% for link in paginator_page.object_list %}
  <div class="indicator my-4 block w-full">
    {% if not link.last_viewed_at %}
    <span class="indicator-item indicator-start badge badge-primary badge-sm"></span>
    {% endif %}
    <div class="card card-side card-compact bg-base-100 shadow-xl">
      <figure class="w-28 h-28">
        <img class="w-28 h-28" src="{{ link.header_image_url }}" alt="{{ link.title }}"/>
      </figure>
      <div class="card-body w-[calc(100%-7rem)]">
        <div class="flex">
          <div class="flex-1 min-w-0">
            <h2 class="card-title"><a href="{% url 'lynx:link_viewer' link.id %}">{{ link.title }}</a></h2>
            <p class="truncate">{{ link.excerpt }}</p>
          </div>
          <div class="flex-none">
            <div class="dropdown dropdown-end">
              <div tabindex="0" role="button" class="btn btn-ghost btn-circle btn-sm m-x-1">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                </svg>

              </div>
              <form method="post" action="{% url 'lynx:link_action' link.id %}" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <ul tabindex="0">
                  <li>
                    <input type="submit" name="action_toggle_unread" value="{% if not link.last_viewed_at %}Mark read{% else %}Mark unread{% endif %}">
                  </li>
                  <li>
                    <a href="{% url 'lynx:link_details' link.id %}">Edit details</a>
                  </li>
                  <li>
                    <input type="submit" name="action_summarize" value="Summarize">
                  </li>
                  <div class="divider"></div>
                  <li>
                    <input class="hover:bg-error hover:text-error-content" type="submit" name="action_delete" value="Delete">
                  </li>
                </ul>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
  {% include 'lynx/paginator.html' %}
  {% else %}
  <p>No links are saved</p>
  {% endif %}
{% endblock %}
